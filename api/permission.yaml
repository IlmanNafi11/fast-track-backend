openapi: 3.0.3
info:
  title: Fiber Boilerplate API - Permission Management
  description: API dokumentasi untuk sistem manajemen permission pada aplikasi Fast Track
  version: 1.0.0
  contact:
    name: Developer Team
    email: developer@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000/api/v1
    description: Development server
  - url: https://api.example.com/v1
    description: Production server

paths:
  /permission:
    get:
      tags:
        - Permission Management
      summary: Dapatkan daftar permission
      description: Endpoint untuk mendapatkan daftar permission dengan fitur pencarian dan pagination
      operationId: getPermissionList
      security:
        - BearerAuth: []
      parameters:
        - name: search
          in: query
          description: Pencarian berdasarkan nama permission
          schema:
            type: string
          example: "admin.dashboard"
        - name: kategori
          in: query
          description: Filter berdasarkan kategori permission
          schema:
            type: string
            enum: [admin, aplikasi]
        - name: page
          in: query
          description: Nomor halaman
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          description: Jumlah item per halaman
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: Daftar permission berhasil diambil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionListResponse'
              example:
                success: true
                message: "Daftar permission berhasil diambil"
                code: 200
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    nama: "admin.dashboard.read"
                    kategori: "admin"
                    deskripsi: "Akses untuk membaca dashboard admin"
                    created_at: "2024-01-01T00:00:00Z"
                    updated_at: "2024-01-01T00:00:00Z"
                  - id: "550e8400-e29b-41d4-a716-446655440002"
                    nama: "aplikasi.transaksi.create"
                    kategori: "aplikasi"
                    deskripsi: "Akses untuk membuat transaksi baru"
                    created_at: "2024-01-01T00:00:00Z"
                    updated_at: "2024-01-01T00:00:00Z"
                meta:
                  current_page: 1
                  total_pages: 5
                  total_records: 47
                  per_page: 10
                timestamp: "2024-01-01T00:00:00Z"
        '401':
          description: Tidak memiliki akses
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Tidak memiliki akses"
                code: 401
                timestamp: "2024-01-01T00:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Terjadi kesalahan pada server"
                code: 500
                timestamp: "2024-01-01T00:00:00Z"

    post:
      tags:
        - Permission Management
      summary: Buat permission baru
      description: Endpoint untuk membuat permission baru dalam sistem
      operationId: createPermission
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePermissionRequest'
            example:
              nama: "admin.user.delete"
              kategori: "admin"
              deskripsi: "Akses untuk menghapus data pengguna"
      responses:
        '201':
          description: Permission berhasil dibuat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionResponse'
              example:
                success: true
                message: "Permission berhasil dibuat"
                code: 201
                data:
                  id: "550e8400-e29b-41d4-a716-446655440003"
                  nama: "admin.user.delete"
                  kategori: "admin"
                  deskripsi: "Akses untuk menghapus data pengguna"
                  created_at: "2024-01-01T00:00:00Z"
                  updated_at: "2024-01-01T00:00:00Z"
                timestamp: "2024-01-01T00:00:00Z"
        '400':
          description: Data validasi tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              example:
                success: false
                message: "Data validasi tidak valid"
                code: 400
                errors:
                  - field: "nama"
                    message: "Nama permission wajib diisi"
                  - field: "kategori"
                    message: "Kategori harus berupa admin atau aplikasi"
                timestamp: "2024-01-01T00:00:00Z"
        '401':
          description: Tidak memiliki akses
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Permission sudah ada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Permission dengan nama tersebut sudah ada"
                code: 409
                timestamp: "2024-01-01T00:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /permission/{id}:
    get:
      tags:
        - Permission Management
      summary: Dapatkan detail permission
      description: Endpoint untuk mendapatkan detail permission berdasarkan ID
      operationId: getPermissionById
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID permission
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
      responses:
        '200':
          description: Detail permission berhasil diambil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionResponse'
              example:
                success: true
                message: "Detail permission berhasil diambil"
                code: 200
                data:
                  id: "550e8400-e29b-41d4-a716-446655440001"
                  nama: "admin.dashboard.read"
                  kategori: "admin"
                  deskripsi: "Akses untuk membaca dashboard admin"
                  created_at: "2024-01-01T00:00:00Z"
                  updated_at: "2024-01-01T00:00:00Z"
                timestamp: "2024-01-01T00:00:00Z"
        '401':
          description: Tidak memiliki akses
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Permission tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Permission tidak ditemukan"
                code: 404
                timestamp: "2024-01-01T00:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Permission Management
      summary: Update permission
      description: Endpoint untuk mengupdate data permission berdasarkan ID
      operationId: updatePermission
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID permission
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePermissionRequest'
            example:
              nama: "admin.dashboard.write"
              kategori: "admin"
              deskripsi: "Akses untuk menulis data dashboard admin"
      responses:
        '200':
          description: Permission berhasil diupdate
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionResponse'
              example:
                success: true
                message: "Permission berhasil diupdate"
                code: 200
                data:
                  id: "550e8400-e29b-41d4-a716-446655440001"
                  nama: "admin.dashboard.write"
                  kategori: "admin"
                  deskripsi: "Akses untuk menulis data dashboard admin"
                  created_at: "2024-01-01T00:00:00Z"
                  updated_at: "2024-01-01T00:00:00Z"
                timestamp: "2024-01-01T00:00:00Z"
        '400':
          description: Data validasi tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          description: Tidak memiliki akses
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Permission tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Permission dengan nama tersebut sudah ada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Permission Management
      summary: Hapus permission
      description: Endpoint untuk menghapus permission berdasarkan ID
      operationId: deletePermission
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID permission
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
      responses:
        '200':
          description: Permission berhasil dihapus
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "Permission berhasil dihapus"
                code: 200
                data: null
                timestamp: "2024-01-01T00:00:00Z"
        '401':
          description: Tidak memiliki akses
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Permission tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Permission tidak dapat dihapus karena masih digunakan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Permission tidak dapat dihapus karena masih digunakan oleh role lain"
                code: 409
                timestamp: "2024-01-01T00:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Permission:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        nama:
          type: string
          example: "admin.dashboard.read"
        kategori:
          type: string
          enum: [admin, aplikasi]
          example: "admin"
        deskripsi:
          type: string
          nullable: true
          example: "Akses untuk membaca dashboard admin"
        created_at:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"

    CreatePermissionRequest:
      type: object
      required:
        - nama
        - kategori
      properties:
        nama:
          type: string
          minLength: 3
          maxLength: 100
          pattern: "^[a-z0-9._-]+$"
          example: "admin.user.delete"
          description: "Nama permission dengan format dot notation (lowercase, angka, dot, underscore, dash)"
        kategori:
          type: string
          enum: [admin, aplikasi]
          example: "admin"
        deskripsi:
          type: string
          maxLength: 255
          nullable: true
          example: "Akses untuk menghapus data pengguna"

    UpdatePermissionRequest:
      type: object
      required:
        - nama
        - kategori
      properties:
        nama:
          type: string
          minLength: 3
          maxLength: 100
          pattern: "^[a-z0-9._-]+$"
          example: "admin.dashboard.write"
          description: "Nama permission dengan format dot notation (lowercase, angka, dot, underscore, dash)"
        kategori:
          type: string
          enum: [admin, aplikasi]
          example: "admin"
        deskripsi:
          type: string
          maxLength: 255
          nullable: true
          example: "Akses untuk menulis data dashboard admin"

    BaseResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: integer
        timestamp:
          type: string
          format: date-time

    SuccessResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              nullable: true

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse' 
        - type: object
          properties:
            errors:
              type: object
              nullable: true

    PermissionResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/Permission'

    PermissionListResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Permission'
            meta:
              $ref: '#/components/schemas/PaginationMeta'

    PaginationMeta:
      type: object
      properties:
        current_page:
          type: integer
          example: 1
        total_pages:
          type: integer
          example: 5
        total_records:
          type: integer
          example: 47
        per_page:
          type: integer
          example: 10

    ValidationError:
      type: object
      properties:
        field:
          type: string
          example: "nama"
        message:
          type: string
          example: "Nama permission wajib diisi"

    ValidationErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            errors:
              type: array
              items:
                $ref: '#/components/schemas/ValidationError'

tags:
  - name: Permission Management
    description: Endpoint untuk sistem manajemen permission pengguna